<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Deepak Finance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    #market{white-space:nowrap;overflow:hidden;font-size:.75rem;background:#111;color:#0f0;padding:.25rem .5rem}
  </style>
</head>
<body class="bg-slate-100 text-slate-800">
  <header class="bg-indigo-600 text-white p-4 shadow">
    <h1 class="text-xl font-bold">Deepak Finance</h1>
    <div id="market">Nifty ~22 400 ▲ 0.3 %</div>
  </header>

  <main class="max-w-4xl mx-auto p-4 grid md:grid-cols-2 gap-4">
    <!-- Add Expense -->
    <section class="bg-white rounded p-4 shadow">
      <h2 class="font-semibold mb-2">Add Expense</h2>
      <input id="desc" class="w-full border px-3 py-2 mb-2 rounded" placeholder="Description" />
      <input id="amt" type="number" class="w-full border px-3 py-2 mb-2 rounded" placeholder="Amount" />
      <select id="cat" class="w-full border px-3 py-2 mb-2 rounded">
        <option>Food</option><option>Travel</option><option>Shopping</option><option>Others</option>
      </select>
      <button onclick="addExp()" class="w-full bg-indigo-600 text-white py-2 rounded">Add</button>
    </section>

    <!-- SIP Calc -->
    <section class="bg-white rounded p-4 shadow">
      <h2 class="font-semibold mb-2">SIP Calculator</h2>
      <input id="p" type="number" value="5000" class="w-full border px-3 py-2 mb-2 rounded" placeholder="Monthly ₹" />
      <input id="r" type="number" value="12" class="w-full border px-3 py-2 mb-2 rounded" placeholder="Return % p.a." />
      <input id="t" type="number" value="5" class="w-full border px-3 py-2 mb-2 rounded" placeholder="Years" />
      <button onclick="sip()" class="w-full bg-indigo-600 text-white py-2 rounded">Calculate</button>
      <p id="sipRes" class="mt-2 font-semibold"></p>
    </section>

    <!-- Pie Chart -->
    <section class="bg-white rounded p-4 shadow md:col-span-2">
      <h2 class="font-semibold mb-2">Spend by Category</h2>
      <canvas id="pie" height="120"></canvas>
    </section>

    <!-- List -->
    <section class="bg-white rounded p-4 shadow md:col-span-2">
      <h2 class="font-semibold mb-2">Recent Expenses</h2>
      <ul id="list" class="divide-y"></ul>
    </section>
  </main>

  <script>
    const STORAGE_KEY='df_exp'; let data=JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
    const colors={Food:'#ef4444',Travel:'#3b82f6',Shopping:'#8b5cf6',Others:'#10b981'};
    function addExp(){
      const d={desc:desc.value,amt:Number(amt.value),cat:cat.value,date:new Date().toISOString()};
      data.push(d); local(); refresh();
      desc.value=amt.value='';
    }
    function del(i){data.splice(i,1); local(); refresh();}
    function local(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data));}
    function refresh(){
      list.innerHTML=data.map((x,i)=>`<li class="flex justify-between py-2"><span>${x.desc} <span class="text-sm text-slate-500">(${x.cat})</span></span><span>₹${x.amt}<button class="ml-2 text-red-600" onclick="del(${i})">✕</button></span></li>`).join('');
      drawPie();
    }
    function drawPie(){
      const cat=data.reduce((a,x)=>(a[x.cat]=(a[x.cat]||0)+x.amt,a),{});
      new Chart(pie,{type:'pie',data:{labels:Object.keys(cat),datasets:[{data:Object.values(cat),backgroundColor:Object.keys(cat).map(k=>colors[k])}]}});
    }
    function sip(){
      const P=Number(p.value),R=Number(r.value)/100/12,T=Number(t.value)*12;
      const M=P*((Math.pow(1+R,T)-1)/R)*(1+R);
      sipRes.textContent=`Maturity ≈ ₹${Math.round(M).toLocaleString()}`;
    }
    refresh();
  </script>
</body>
</html>
